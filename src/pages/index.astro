<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<title>Grita - Evaluate XML</title>
	</head>
	<body>
		<h1>Grita: XML Analysis</h1>

		<section class="upload-section">
			<h2>Upload Source Documents</h2>
			<form id="upload-form">
				<div class="field">
					<label for="le-file">LE (Loan Estimate) XML:</label>
					<input type="file" id="le-file" name="le-file" accept=".xml" required />
				</div>
				<div class="field">
					<label for="cd-file">CD (Closing Disclosure) XML:</label>
					<input type="file" id="cd-file" name="cd-file" accept=".xml" required />
				</div>
				<button type="submit" id="submit-btn">Run Analysis</button>
			</form>
		</section>

		<section id="result-section" style="display: none;">
			<h2>Analysis Report</h2>
			<pre id="report-output"></pre>
		</section>

		<script>
			const form = document.getElementById('upload-form') as HTMLFormElement;
			const reportOutput = document.getElementById('report-output')!;
			const resultSection = document.getElementById('result-section')!;

			form.addEventListener('submit', async (e) => {
				e.preventDefault();

				const formData = new FormData(form);
				const btn = document.getElementById('submit-btn') as HTMLButtonElement;

				try {
					btn.disabled = true;
					btn.textContent = 'Processing...';

					const response = await fetch('http://localhost:8000/api/v1/evaluate', {
						method: 'POST',
						body: formData, // FormData automatically sets multipart/form-data
					});

					const result = await response.json();

					resultSection.style.display = 'block';
					reportOutput.textContent = JSON.stringify(result, null, 2);
				} catch (error) {
					console.error('Analysis failed:', error);
					alert('Error connecting to Gritum engine.');
				} finally {
					btn.disabled = false;
					btn.textContent = 'Run Analysis';
				}
			});
		</script>

		<style>
			body { font-family: system-ui, sans-serif; max-width: 800px; margin: 0 auto; padding: 2rem; line-height: 1.5; }
			.upload-section { background: #f4f4f9; padding: 2rem; border-radius: 12px; margin-bottom: 2rem; }
			.field { margin-bottom: 1.5rem; }
			label { display: block; margin-bottom: 0.5rem; font-weight: bold; }
			button {
				background: #0070f3; color: white; border: none; padding: 0.75rem 1.5rem;
				border-radius: 6px; cursor: pointer; font-size: 1rem;
			}
			button:disabled { background: #ccc; }
			pre { background: #222; color: #adff2f; padding: 1.5rem; border-radius: 8px; overflow-x: auto; }
		</style>
	</body>
</html>